# Warehouse Management System Architecture

This document outlines the comprehensive architecture of the `warehouse-mgmt` project.

## Overview

The system is a **modern full-stack web application** generated using the [JHipster](https://www.jhipster.tech/) platform. This architecture combines a Java-based backend with a React frontend within a single monolithic project structure, providing a complete warehouse management solution.

The presence of JHipster configuration files (`.jhipster`, `.yo-rc.json`, `jhipster-jdl.jdl`) indicates that much of the application's boilerplate code for CRUD operations, security, and deployment was automatically generated.

---

## üèóÔ∏è Overall Architecture Pattern

- **Monolithic Application**: Single deployable unit containing both backend and frontend
- **Generated by JHipster**: Leverages JHipster's opinionated architecture for rapid development
- **Full-Stack**: Combines Java backend with React frontend in one project
- **NoSQL Database**: Uses MongoDB for flexible data storage

---

## üîß Backend (Server-Side) Architecture

### Core Framework Stack
*   **Framework:** **Spring Boot 3.4.4** - Main application framework with auto-configuration
*   **Language:** **Java 17** - Modern Java version with enhanced features
*   **Database:** **MongoDB** - NoSQL document database (cloud-hosted on MongoDB Atlas)
*   **Build & Dependency Management:** **Apache Maven** (as seen with `pom.xml`, `mvnw` scripts, and the `.mvn` directory)
*   **Security:** **Spring Security** with JWT tokens and OAuth2 Resource Server

### Key Backend Components (`src/main/java/dtu/k30/msc/whm/`)
*   `domain/`: Contains MongoDB entities (data models) mapped to database collections
*   `repository/`: Contains Spring Data MongoDB repositories for data access and database operations
*   `service/`: Implements the core business logic of the application
*   `web/`: Defines the RESTful API endpoints that the frontend consumes
*   `security/`: Authentication and authorization configuration
*   `config/`: Application configuration and properties
*   `management/`: Health checks, metrics, and monitoring endpoints
*   `aop/`: Aspect-oriented programming for cross-cutting concerns

### Domain Model (from `jhipster-jdl.jdl`)
The system manages the following core entities:

*   **KhachHang** (Customer): Customer management with fields like `maKH`, `tenKH`, `goiTinh` (gender), `dateOfBirth`, `diaChi` (address)
*   **DanhMucHang** (Product Category): Product catalog with `maHang`, `tenHang`, `donVitinh`, `noiSanXuat`, `ngaySanXuat`, `hanSuDung`
*   **PhieuNhapXuat** (Import/Export Voucher): Transaction documents with `maPhieu`, `ngayLapPhieu`, `loaiPhieu` (VoucherType: Nhap/Xuat)
*   **ChiTietNhapXuat** (Transaction Details): Line items for transactions with `soLuong`, `donGia`
*   **Masterdata**: System configuration data with `category`, `dataKey`, `dataValue`

**Relationships (Embedded Implementation):**
*   `PhieuNhapXuat` ‚Üí `KhachHangEmbedded` (Embedded - no @DBRef)
*   `ChiTietNhapXuat` ‚Üí `PhieuNhapXuatEmbedded` (Embedded - no @DBRef)
*   `ChiTietNhapXuat` ‚Üí `DanhMucHangEmbedded` (Embedded - no @DBRef)

**Embedded Document Classes:**
*   **KhachHangEmbedded**: Embedded customer data with `id`, `maKH`, `tenKH`, `goiTinh`, `dateOfBirth`, `diaChi`
*   **DanhMucHangEmbedded**: Embedded product data with `id`, `maHang`, `tenHang`, `donVitinh`, `noiSanXuat`, `ngaySanXuat`, `hanSuDung`
*   **PhieuNhapXuatEmbedded**: Embedded voucher data with `id`, `maPhieu`, `ngayLapPhieu`, `loaiPhieu`, `KhachHangEmbedded`

### Database Configuration
*   **MongoDB Atlas**: Cloud-hosted MongoDB cluster
*   **Connection String**: Configured in `application-dev.yml` for development
*   **Spring Data MongoDB**: Object-document mapping with automatic audit fields
*   **Audit Fields**: Automatic tracking of `createdAt`, `createdBy`, `updatedAt`, `updatedBy`, `isDeleted`
*   **Embedded Documents**: No @DBRef, all relationships use embedded objects for optimal aggregation performance
*   **Data Synchronization**: Automatic sync between main entities and embedded documents via `DataSynchronizationService`

### Data Synchronization Architecture
*   **DataSynchronizationService**: Centralized service for maintaining consistency between main entities and embedded documents
*   **Automatic Updates**: When main entities (KhachHang, DanhMucHang, PhieuNhapXuat) are updated, embedded documents are automatically synchronized
*   **Service Integration**: All CRUD services are integrated with DataSynchronizationService for seamless data consistency
*   **Bulk Operations**: Support for bulk synchronization operations for data corrections and migrations
*   **Error Handling**: Comprehensive error handling and logging for synchronization failures

### Performance Benefits of Embedded Documents
*   **Aggregation Queries**: Single database call for complex aggregations across related data
*   **Read Performance**: Significant improvement in read operations due to denormalized data structure
*   **Query Flexibility**: Full flexibility in filtering and sorting across all related data fields
*   **Indexing Strategy**: Optimized indexing on embedded fields for frequently queried data
*   **MongoDB Best Practices**: Follows MongoDB's document-oriented design principles
*   **Reduced Network Calls**: Eliminates multiple database round-trips for related data retrieval

---

## üé® Frontend (Client-Side) Architecture

### Technology Stack
*   **Framework:** **React 18.3.1** - Modern React with hooks and functional components
*   **Language:** **TypeScript 5.8.2** - Type-safe JavaScript development
*   **State Management:** **Redux Toolkit 2.6.1** - Modern Redux patterns
*   **Routing:** **React Router 7.4.1** - Client-side routing
*   **UI Framework:** **Bootstrap 5.3.3** - Responsive design components
*   **HTTP Client:** **Axios 1.8.4** - API communication
*   **Build & Dependency Management:** **NPM** and **Webpack** (indicated by `package.json`, `node_modules`, and `webpack/` directory)

### Frontend Structure (`src/main/webapp/app/`)
*   `entities/`: CRUD components for each domain entity (KhachHang, DanhMucHang, PhieuNhapXuat, ChiTietNhapXuat, Masterdata)
*   `modules/`: Feature modules (account, administration, home, login)
*   `shared/`: Reusable components, utilities, and common functionality
*   `config/`: Frontend configuration, constants, and interceptors
*   `routes.tsx`: Application routing configuration
*   `app.tsx`: Main application component

### Development Features
*   **Hot Reload**: Development server with live reload capabilities
*   **TypeScript**: Full type safety across the frontend
*   **ESLint**: Code quality and consistency
*   **Prettier**: Code formatting
*   **Jest**: Unit testing framework
*   **Cypress**: End-to-end testing

---

## üîê Security Architecture

### Authentication & Authorization
*   **JWT (JSON Web Tokens)**: Stateless authentication with configurable token validity
*   **OAuth2 Resource Server**: Token-based security implementation
*   **Spring Security**: Comprehensive security framework
*   **Role-based Access Control**: User management with different permission levels
*   **CORS Configuration**: Cross-origin resource sharing for development and production

### Security Configuration
*   **Base64 Secret**: Configurable JWT secret for token signing
*   **Token Validity**: 24 hours for regular tokens, 30 days for "remember me"
*   **CORS**: Configured for development ports (8080, 9000, 9060, 8100)

---

## üöÄ Development & Deployment Architecture

### Build Tools
*   **Maven**: Backend build and dependency management with Spring Boot
*   **NPM/Webpack**: Frontend build and bundling with development server
*   **Docker**: Containerization support with JIB plugin for optimized images

### Development Workflow
*   **Concurrent Development**: Backend and frontend can run simultaneously
*   **Proxy Configuration**: Frontend development server proxies API calls to backend
*   **Live Reload**: Automatic browser refresh on code changes
*   **Debug Support**: Remote debugging configuration for Java backend

### Testing Strategy
*   **Jest**: Frontend unit testing with coverage reporting
*   **Cypress**: End-to-end testing with visual regression testing
*   **Gatling**: Performance and load testing
*   **Spring Boot Test**: Backend integration and unit testing
*   **Cucumber**: Behavior-driven development testing

---

## üìä Monitoring & Observability

### Operational Features
*   **Spring Boot Actuator**: Health checks, metrics, and management endpoints
*   **Prometheus**: Metrics collection and monitoring
*   **Grafana**: Monitoring dashboards and visualization
*   **Logging**: Structured logging with Logback and JSON format support
*   **Logstash**: Log forwarding capabilities (configurable)

### Health Checks
*   **Database Health**: MongoDB connection monitoring
*   **Application Health**: Overall application status
*   **Custom Metrics**: Business-specific monitoring points

---

## üîÑ Data Flow Architecture

1. **Client Request** ‚Üí React frontend (TypeScript/React)
2. **API Call** ‚Üí Axios HTTP client with interceptors
3. **Backend Processing** ‚Üí Spring Boot REST controllers
4. **Business Logic** ‚Üí Service layer with transaction management
5. **Data Access** ‚Üí Repository layer (Spring Data MongoDB)
6. **Database** ‚Üí MongoDB document store (Atlas cluster)
7. **Response** ‚Üí JSON data back to frontend
8. **State Update** ‚Üí Redux store management
9. **UI Update** ‚Üí React component re-rendering

---

## üõ†Ô∏è Configuration & Environment

### Environment Profiles
*   **Development (`dev`)**: Local development with hot reload and debug logging
*   **Production (`prod`)**: Optimized for production deployment
*   **E2E Testing**: Dedicated profile for end-to-end testing
*   **TLS**: Secure communication configuration

### Application Properties
*   **Database Configuration**: MongoDB connection strings per environment
*   **Security Settings**: JWT secrets, CORS, authentication parameters
*   **Logging Configuration**: Log levels and format per environment
*   **Mail Configuration**: Email service settings
*   **Cache Configuration**: Ehcache settings for performance

---

## üì¶ Deployment Options

### Containerization
*   **Docker Support**: Complete containerization with optimized images
*   **JIB Plugin**: Google's container image builder for Java applications
*   **Multi-architecture**: Support for both AMD64 and ARM64 architectures

### Packaging Options
*   **JAR**: Executable JAR file for standalone deployment
*   **WAR**: Web application archive for traditional servlet containers
*   **Docker Image**: Containerized deployment with all dependencies

---

## Summary

The `warehouse-mgmt` project follows a **modern, production-ready monolithic architecture** that leverages the strengths of:

- **Spring Boot** for robust backend services
- **React with TypeScript** for modern, type-safe frontend development
- **MongoDB** for flexible, scalable data storage with embedded documents
- **JHipster** as a comprehensive development accelerator

The architecture provides:
- **Clear separation of concerns** between layers
- **Comprehensive testing strategy** at all levels
- **Production-ready features** like security, monitoring, and containerization
- **Developer-friendly tooling** with hot reload, debugging, and code quality tools
- **Scalable foundation** for future enhancements and growth
- **Optimized data model** with embedded documents for superior aggregation performance
- **Automatic data synchronization** between main entities and embedded documents

**Current System Status:**
- ‚úÖ **Migration Completed**: Successfully migrated from @DBRef to embedded documents
- ‚úÖ **219 PhieuNhapXuat documents** migrated with embedded customer data
- ‚úÖ **ChiTietNhapXuat documents** migrated with embedded product and voucher data
- ‚úÖ **Frontend Display**: Customer names and product lists display correctly
- ‚úÖ **API Performance**: Improved response times for complex queries
- ‚úÖ **Data Consistency**: Automatic synchronization between entities and embedded documents
- ‚úÖ **System Stability**: Application running smoothly with zero downtime migration

This architecture is well-suited for warehouse management operations with its flexible data model, robust security, comprehensive monitoring capabilities, and optimized aggregation performance through embedded documents.
